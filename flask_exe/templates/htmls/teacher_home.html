{% extends "layout.html" %}

{% block contents %}
<article>
    <div class="teacher-header">
        <h1>ğŸ“š ç”Ÿå¾’ã®æ—¥èªŒç®¡ç†</h1>
        <span class="user-badge">ğŸ‘¤ {{ session.get('username') }}å…ˆç”Ÿ</span>
        <p>å…¨ç”Ÿå¾’ã®æ—¥èªŒã‚’ç¢ºèªãƒ»ç®¡ç†ã—ã¾ã™</p>
    </div>

    <div class="stats-section">
        <div class="stat-card">
            <h3>ğŸ“ ç·æ—¥èªŒæ•°</h3>
            <p class="number">{{ all_reports | length }}</p>
        </div>
        <div class="stat-card">
            <h3>ğŸ‘¥ æå‡ºç”Ÿå¾’æ•°</h3>
            {% set usernames = [] %}
            {% for report in all_reports %}
                {% if report.username not in usernames %}
                    {% set _ = usernames.append(report.username) %}
                {% endif %}
            {% endfor %}
            <p class="number">{{ usernames | length }}</p>
        </div>
    </div>

    <section>
        <h2>ğŸ” æ—¥èªŒæ¤œç´¢ãƒ»ä¸€è¦§</h2>
        
        <div class="search-box">
            <form method="GET" action="/home">
                <label for="search"><strong>æ¤œç´¢ï¼š</strong></label>
                <input type="text" id="search" name="search" value="{{ search_query if search_query else '' }}" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ã‚¿ã‚¤ãƒˆãƒ«ã€å†…å®¹ã€ã‚³ãƒ¡ãƒ³ãƒˆã€æ—¥ä»˜ã§æ¤œç´¢...">
                <button type="submit">ğŸ” æ¤œç´¢</button>
                {% if search_query %}
                <a href="/home">âœ– ã‚¯ãƒªã‚¢</a>
                <span class="search-result">æ¤œç´¢çµæœï¼š{{ all_reports | length }} ä»¶</span>
                {% endif %}
            </form>
        </div>
        
        {% if all_reports %}
        <table class="reports-table">
            <thead>
                <tr>
                    <th>ğŸ‘¤ æå‡ºè€…</th>
                    <th>ğŸ“… æ—¥ä»˜</th>
                    <th>ğŸ“Œ ã‚¿ã‚¤ãƒˆãƒ«</th>
                    <th>ğŸ“ å†…å®¹</th>
                    <th>ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ</th>
                    <th>âš™ï¸ æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for report in all_reports %}
                <tr>
                    <td>{{ report.username }}</td>
                    <td>{{ report.date }}</td>
                    <td>{{ report.title }}</td>
                    <td>{{ report.content }}</td>
                    <td>
                        {% if report.comment %}
                            {{ report.comment }}
                            {% if report.comment_teacher %}
                                <div style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">
                                    ï¼ˆ{{ report.comment_teacher }}å…ˆç”Ÿï¼‰
                                </div>
                            {% endif %}
                        {% else %}
                            ï¼
                        {% endif %}
                    </td>
                    <td>
                        <form method="POST" action="/submit_comment" class="comment-form">
                            <input type="hidden" name="row_id" value="{{ report.row_id }}">
                            <textarea name="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..." required rows="3">{{ report.comment if report.comment else '' }}</textarea>
                            <button type="submit">ğŸ’¾ ä¿å­˜</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            {% if search_query %}
            <p>ã€Œ{{ search_query }}ã€ã«ä¸€è‡´ã™ã‚‹æ—¥èªŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            {% else %}
            <p>ã¾ã ç”Ÿå¾’ã‹ã‚‰æ—¥èªŒãŒæå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
            {% endif %}
        </div>
        {% endif %}
    </section>
</article>
{% endblock %}
